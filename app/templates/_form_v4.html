<!-- templates/_form_v4.html -->
<div id="form-v4" class="calculator-form">
    {# A linha {% set ... %} foi removida. A variável 'metrics' agora vem do include. #}
    <h2 class="text-2xl font-bold text-gray-900 mb-4">Métricas CVSS 4.0</h2>
    
    <!-- ########## Métricas Base ########## -->
    <h3 class="text-lg font-semibold text-gray-900">Métricas de Base</h3>
    <div class="metric-group !mt-4 !pt-4 border-t border-gray-200">
        <h4 class="text-md font-semibold text-gray-700">Explorabilidade</h4>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mt-4">
            <div><label class="block text-sm font-medium">Vetor de Ataque (AV)</label><select name="v4_AV" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="N" {% if metrics.AV == 'N' %}selected{% endif %}>Rede</option><option value="A" {% if metrics.AV == 'A' %}selected{% endif %}>Adjacente</option><option value="L" {% if metrics.AV == 'L' %}selected{% endif %}>Local</option><option value="P" {% if metrics.AV == 'P' %}selected{% endif %}>Físico</option></select></div>
            <div><label class="block text-sm font-medium">Complexidade (AC)</label><select name="v4_AC" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="L" {% if metrics.AC == 'L' %}selected{% endif %}>Baixa</option><option value="H" {% if metrics.AC == 'H' %}selected{% endif %}>Alta</option></select></div>
            <div><label class="block text-sm font-medium">Req. de Ataque (AT)</label><select name="v4_AT" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="N" {% if metrics.AT == 'N' %}selected{% endif %}>Nenhum</option><option value="P" {% if metrics.AT == 'P' %}selected{% endif %}>Presente</option></select></div>
            <div><label class="block text-sm font-medium">Privilégios (PR)</label><select name="v4_PR" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="N" {% if metrics.PR == 'N' %}selected{% endif %}>Nenhum</option><option value="L" {% if metrics.PR == 'L' %}selected{% endif %}>Baixo</option><option value="H" {% if metrics.PR == 'H' %}selected{% endif %}>Alto</option></select></div>
            <div><label class="block text-sm font-medium">Interação (UI)</label><select name="v4_UI" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="N" {% if metrics.UI == 'N' %}selected{% endif %}>Nenhuma</option><option value="P" {% if metrics.UI == 'P' %}selected{% endif %}>Passiva</option><option value="A" {% if metrics.UI == 'A' %}selected{% endif %}>Ativa</option></select></div>
        </div>
    </div>
    <div class="metric-group">
        <h4 class="text-md font-semibold text-gray-700">Impacto no Sistema Vulnerável</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
            <div><label class="block text-sm font-medium">Confidencialidade (VC)</label><select name="v4_VC" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="H" {% if metrics.VC == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.VC == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.VC == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">Integridade (VI)</label><select name="v4_VI" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="H" {% if metrics.VI == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.VI == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.VI == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">Disponibilidade (VA)</label><select name="v4_VA" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="H" {% if metrics.VA == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.VA == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.VA == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
        </div>
    </div>
    <div class="metric-group">
         <h4 class="text-md font-semibold text-gray-700">Impacto no Sistema Subsequente</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
            <div><label class="block text-sm font-medium">Confidencialidade (SC)</label><select name="v4_SC" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="H" {% if metrics.SC == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.SC == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.SC == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">Integridade (SI)</label><select name="v4_SI" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="H" {% if metrics.SI == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.SI == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.SI == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">Disponibilidade (SA)</label><select name="v4_SA" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="H" {% if metrics.SA == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.SA == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.SA == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
        </div>
    </div>

    <!-- ########## Métricas de Ameaça ########## -->
    <h3 class="text-lg font-semibold text-gray-900 mt-6">Métricas de Ameaça</h3>
    <div class="metric-group !mt-4 !pt-4 border-t border-gray-200">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div><label class="block text-sm font-medium">Maturidade do Exploit (E)</label><select name="v4_E" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.E or metrics.E == 'X' %}selected{% endif %}>Não Definido</option><option value="A" {% if metrics.E == 'A' %}selected{% endif %}>Atingível</option><option value="P" {% if metrics.E == 'P' %}selected{% endif %}>Prova de Conceito</option><option value="U" {% if metrics.E == 'U' %}selected{% endif %}>Não Relatado</option></select></div>
        </div>
    </div>

    <!-- ########## Métricas Ambientais ########## -->
    <h3 class="text-lg font-semibold text-gray-900 mt-6">Métricas Ambientais</h3>
    <div class="metric-group !mt-4 !pt-4 border-t border-gray-200">
        <h4 class="text-md font-semibold text-gray-700">Requisitos de Segurança</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
            <div><label class="block text-sm font-medium">Confidencialidade (CR)</label><select name="v4_CR" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.CR or metrics.CR == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.CR == 'H' %}selected{% endif %}>Alto</option><option value="M" {% if metrics.CR == 'M' %}selected{% endif %}>Médio</option><option value="L" {% if metrics.CR == 'L' %}selected{% endif %}>Baixo</option></select></div>
            <div><label class="block text-sm font-medium">Integridade (IR)</label><select name="v4_IR" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.IR or metrics.IR == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.IR == 'H' %}selected{% endif %}>Alto</option><option value="M" {% if metrics.IR == 'M' %}selected{% endif %}>Médio</option><option value="L" {% if metrics.IR == 'L' %}selected{% endif %}>Baixo</option></select></div>
            <div><label class="block text-sm font-medium">Disponibilidade (AR)</label><select name="v4_AR" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.AR or metrics.AR == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.AR == 'H' %}selected{% endif %}>Alto</option><option value="M" {% if metrics.AR == 'M' %}selected{% endif %}>Médio</option><option value="L" {% if metrics.AR == 'L' %}selected{% endif %}>Baixo</option></select></div>
        </div>
    </div>
    <div class="metric-group">
        <h4 class="text-md font-semibold text-gray-700">Métricas de Base Modificadas</h4>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4">
            <div><label class="block text-sm font-medium">AV Modificado (MAV)</label><select name="v4_MAV" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MAV or metrics.MAV == 'X' %}selected{% endif %}>Não Definido</option><option value="N" {% if metrics.MAV == 'N' %}selected{% endif %}>Rede</option><option value="A" {% if metrics.MAV == 'A' %}selected{% endif %}>Adjacente</option><option value="L" {% if metrics.MAV == 'L' %}selected{% endif %}>Local</option><option value="P" {% if metrics.MAV == 'P' %}selected{% endif %}>Físico</option></select></div>
            <div><label class="block text-sm font-medium">AC Modificado (MAC)</label><select name="v4_MAC" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MAC or metrics.MAC == 'X' %}selected{% endif %}>Não Definido</option><option value="L" {% if metrics.MAC == 'L' %}selected{% endif %}>Baixa</option><option value="H" {% if metrics.MAC == 'H' %}selected{% endif %}>Alta</option></select></div>
            <div><label class="block text-sm font-medium">AT Modificado (MAT)</label><select name="v4_MAT" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MAT or metrics.MAT == 'X' %}selected{% endif %}>Não Definido</option><option value="N" {% if metrics.MAT == 'N' %}selected{% endif %}>Nenhum</option><option value="P" {% if metrics.MAT == 'P' %}selected{% endif %}>Presente</option></select></div>
            <div><label class="block text-sm font-medium">PR Modificado (MPR)</label><select name="v4_MPR" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MPR or metrics.MPR == 'X' %}selected{% endif %}>Não Definido</option><option value="N" {% if metrics.MPR == 'N' %}selected{% endif %}>Nenhum</option><option value="L" {% if metrics.MPR == 'L' %}selected{% endif %}>Baixo</option><option value="H" {% if metrics.MPR == 'H' %}selected{% endif %}>Alto</option></select></div>
            <div><label class="block text-sm font-medium">UI Modificado (MUI)</label><select name="v4_MUI" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MUI or metrics.MUI == 'X' %}selected{% endif %}>Não Definido</option><option value="N" {% if metrics.MUI == 'N' %}selected{% endif %}>Nenhuma</option><option value="P" {% if metrics.MUI == 'P' %}selected{% endif %}>Passiva</option><option value="A" {% if metrics.MUI == 'A' %}selected{% endif %}>Ativa</option></select></div>
            <div><label class="block text-sm font-medium">VC Modificado (MVC)</label><select name="v4_MVC" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MVC or metrics.MVC == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.MVC == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.MVC == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.MVC == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">VI Modificado (MVI)</label><select name="v4_MVI" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MVI or metrics.MVI == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.MVI == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.MVI == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.MVI == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">VA Modificado (MVA)</label><select name="v4_MVA" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MVA or metrics.MVA == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.MVA == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.MVA == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.MVA == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">SC Modificado (MSC)</label><select name="v4_MSC" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MSC or metrics.MSC == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.MSC == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.MSC == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.MSC == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">SI Modificado (MSI)</label><select name="v4_MSI" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MSI or metrics.MSI == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.MSI == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.MSI == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.MSI == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
            <div><label class="block text-sm font-medium">SA Modificado (MSA)</label><select name="v4_MSA" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.MSA or metrics.MSA == 'X' %}selected{% endif %}>Não Definido</option><option value="H" {% if metrics.MSA == 'H' %}selected{% endif %}>Alta</option><option value="L" {% if metrics.MSA == 'L' %}selected{% endif %}>Baixa</option><option value="N" {% if metrics.MSA == 'N' %}selected{% endif %}>Nenhuma</option></select></div>
        </div>
    </div>
    
    <!-- ########## Métricas Suplementares ########## -->
    <h3 class="text-lg font-semibold text-gray-900 mt-6">Métricas Suplementares (Informativas)</h3>
    <div class="metric-group !mt-4 !pt-4 border-t border-gray-200">
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mt-4">
            <div><label class="block text-sm font-medium">Segurança (S)</label><select name="v4_S" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.S or metrics.S == 'X' %}selected{% endif %}>Não Definido</option><option value="N" {% if metrics.S == 'N' %}selected{% endif %}>Negligenciável</option><option value="P" {% if metrics.S == 'P' %}selected{% endif %}>Presente</option></select></div>
            <div><label class="block text-sm font-medium">Automatizável (AU)</label><select name="v4_AU" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.AU or metrics.AU == 'X' %}selected{% endif %}>Não Definido</option><option value="Y" {% if metrics.AU == 'Y' %}selected{% endif %}>Sim</option><option value="N" {% if metrics.AU == 'N' %}selected{% endif %}>Não</option></select></div>
            <div><label class="block text-sm font-medium">Recuperação (R)</label><select name="v4_R" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.R or metrics.R == 'X' %}selected{% endif %}>Não Definido</option><option value="A" {% if metrics.R == 'A' %}selected{% endif %}>Automática</option><option value="I" {% if metrics.R == 'I' %}selected{% endif %}>Irrecuperável</option><option value="L" {% if metrics.R == 'L' %}selected{% endif %}>Laboriosa</option></select></div>
            <div><label class="block text-sm font-medium">Densidade de Valor (V)</label><select name="v4_V" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.V or metrics.V == 'X' %}selected{% endif %}>Não Definido</option><option value="D" {% if metrics.V == 'D' %}selected{% endif %}>Difusa</option><option value="C" {% if metrics.V == 'C' %}selected{% endif %}>Concentrada</option></select></div>
            <div><label class="block text-sm font-medium">Esforço de Resposta (RE)</label><select name="v4_RE" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.RE or metrics.RE == 'X' %}selected{% endif %}>Não Definido</option><option value="L" {% if metrics.RE == 'L' %}selected{% endif %}>Baixo</option><option value="M" {% if metrics.RE == 'M' %}selected{% endif %}>Médio</option><option value="H" {% if metrics.RE == 'H' %}selected{% endif %}>Alto</option></select></div>
            <div><label class="block text-sm font-medium">Urgência do Fornecedor (P)</label><select name="v4_P" class="mt-1 w-full rounded-md border-gray-300 shadow-sm"><option value="X" {% if not metrics.P or metrics.P == 'X' %}selected{% endif %}>Não Definido</option><option value="C" {% if metrics.P == 'C' %}selected{% endif %}>Limpar</option><option value="G" {% if metrics.P == 'G' %}selected{% endif %}>Verde</option><option value="A" {% if metrics.P == 'A' %}selected{% endif %}>Âmbar</option><option value="R" {% if metrics.P == 'R' %}selected{% endif %}>Vermelho</option></select></div>
        </div>
    </div>
</div>
